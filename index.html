<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>2D Flappy Bird</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <!-- Background -->
    <a-plane position="0 0 -5" rotation="-90 0 0" width="10" height="10" color="#87CEEB"></a-plane>
    
    <!-- Roof -->
    <a-plane position="0 2.5 -5" rotation="0 0 0" width="10" height=".1" color="#555"></a-plane>
    
    <!-- Floor -->
    <a-plane position="0 -2.5 -5" rotation="0 0 0" width="10" height=".1" color="#555"></a-plane>
    
    <!-- Bird -->
    <a-plane id="bird" position="-2 0 -5" width="0.5" height="0.5" color="yellow"></a-plane>
    
    <!-- Pipes -->
    <a-plane id="pipeTop" position="3 1.5 -5" width="0.5" height="1" color="green"></a-plane>
    <a-plane id="pipeBottom" position="3 -1.5 -5" width="0.5" height="1" color="green"></a-plane>
    
    <!-- Camera -->
    <a-entity id="camera" camera position="0 0 0"></a-entity>
  </a-scene>

  <script>
    // Constants
    const GRAVITY = -0.005;
    const JUMP_STRENGTH = 0.1;
    const PIPE_SPEED = 0.05;
    const PIPE_GAP = 3; // Gap between top and bottom of pipes

    let birdVelocity = 0;
    let gameRunning = true;

    // Bird jump on space key press
    document.addEventListener('keydown', function(event) {
      if (event.code === 'j' && gameRunning) {
        birdVelocity = JUMP_STRENGTH;
      }
    });

    // Game loop
    function gameLoop() {
      if (!gameRunning) return;

      moveBird();
      movePipes();
      checkCollision();
      requestAnimationFrame(gameLoop);
    }

    // Move the bird
    function moveBird() {
      const bird = document.getElementById('bird');
      const birdPosition = bird.getAttribute('position');

      birdVelocity += GRAVITY;
      birdPosition.y += birdVelocity;

      bird.setAttribute('position', birdPosition);
    }

    // Move the pipes
    function movePipes() {
      const pipeTop = document.getElementById('pipeTop');
      const pipeBottom = document.getElementById('pipeBottom');
      const pipeTopPosition = pipeTop.getAttribute('position');
      const pipeBottomPosition = pipeBottom.getAttribute('position');

      pipeTopPosition.x -= PIPE_SPEED;
      pipeBottomPosition.x -= PIPE_SPEED;

      if (pipeTopPosition.x < -5) {
        resetPipes(pipeTop, pipeBottom);
      }

      pipeTop.setAttribute('position', pipeTopPosition);
      pipeBottom.setAttribute('position', pipeBottomPosition);
    }

    // Reset pipes to the right side with a gap
    function resetPipes(pipeTop, pipeBottom) {
      const playableHeight = 5; // Distance between roof and floor (2.5 + 2.5)
      const maxY = playableHeight / 2; // Maximum allowed Y position for top pipe
      const minY = -maxY + PIPE_GAP; // Minimum allowed Y position for top pipe (considering gap)

      const randomY = Math.random() * (maxY - minY) + minY; // Generate random Y within playable area
      pipeTop.setAttribute('position', { x: 5, y: randomY, z: -5 });
      pipeBottom.setAttribute('position', { x: 5, y: randomY - PIPE_GAP, z: -5 });
    }

    // Check collision with pipes, roof, or floor
    function checkCollision() {
      const bird = document.getElementById('bird');
      const birdPosition = bird.getAttribute('position');
      const pipeTop = document.getElementById('pipeTop');
      const pipeBottom = document.getElementById('pipeBottom');
      const pipeTopPosition = pipeTop.getAttribute('position');
      const pipeBottomPosition = pipeBottom.getAttribute('position');

      // Check collision with pipes
      if (
        birdPosition.x > pipeTopPosition.x - 0.25 && birdPosition.x < pipeTopPosition.x + 0.25 &&
        (birdPosition.y > pipeTopPosition.y - 0.5 || birdPosition.y < pipeBottomPosition.y + 0.5)
      ) {
        endGame();
      }

      // Check collision with roof or floor
      if (birdPosition.y > 2.5 || birdPosition.y < -2.5) {
        endGame();
      }
    }

    // Function to end the game
    function endGame() {
      gameRunning = false;
      console.log('Game Over!');

      // Prompt to retry
      const retry = confirm('Game Over! Retry?');
      if (retry) {
        resetGame();
      }
    }

    // Function to reset the game
    function resetGame() {
      const bird = document.getElementById('bird');
      bird.setAttribute('position', '-2 0 -5');

      gameRunning = true;
      birdVelocity = 0;
      gameLoop();
    }

    // Start the game loop
    gameLoop();
  </script>
</body>
</html>
